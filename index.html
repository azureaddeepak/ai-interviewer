<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI DevOps Interviewer</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', Arial, sans-serif;
      text-align: center;
      padding: 30px;
      background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
      color: #333;
      margin: 0;
      min-height: 100vh;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      padding: 30px;
      overflow: hidden;
    }
    h1 {
      color: #0078d4;
      margin-bottom: 10px;
      font-size: 28px;
    }
    p#question {
      font-size: 18px;
      line-height: 1.6;
      background: #f0f8ff;
      padding: 15px;
      border-radius: 10px;
      margin: 20px 0;
    }
    button {
      font-size: 16px;
      padding: 12px 30px;
      margin: 15px 0;
      border: none;
      border-radius: 50px;
      background: #0078d4;
      color: white;
      cursor: pointer;
      font-weight: 600;
      box-shadow: 0 4px 10px rgba(0,120,212,0.3);
      transition: all 0.3s;
    }
    button:hover {
      background: #005a9e;
      transform: translateY(-2px);
    }
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    #status, #timer {
      margin: 15px 0;
      font-style: italic;
      color: #666;
      font-size: 16px;
    }
    #timer {
      font-size: 24px;
      font-weight: bold;
      color: #d90000;
      display: none;
    }
    #result {
      font-size: 20px;
      font-weight: bold;
      padding: 20px;
      border-radius: 10px;
      margin: 20px auto;
      max-width: 800px;
      display: none;
    }
    .pass {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .fail {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    #transcript {
      white-space: pre-wrap;
      background: #f9f9f9;
      padding: 20px;
      border-radius: 10px;
      max-height: 300px;
      overflow-y: auto;
      text-align: left;
      border: 1px solid #ddd;
      margin: 20px 0;
      font-size: 14px;
    }
    .ai-text {
      color: #0078d4;
      font-weight: bold;
      margin: 8px 0;
      display: block;
    }
    .user-text {
      color: #28a745;
      font-weight: bold;
      margin: 8px 0;
      display: block;
    }
    footer {
      margin-top: 30px;
      color: #888;
      font-size: 14px;
    }
  </style>
</head>
<body>

  <div class="container">
    <h1>üéôÔ∏è AI Interviewer (Azure DevOps + AKS)</h1>
    <p id="question">Press "Start Interview" to begin.</p>

    <button id="startBtn">üü¢ Start First Round Interview</button>

    <div id="status">Ready when you are.</div>
    <div id="timer">‚è±Ô∏è Time Remaining: <span id="time">40</span> seconds</div>
    <div id="result"></div>

    <h3>Interview Transcript</h3>
    <pre id="transcript"></pre>

    <footer>
      ¬© 2025 AI Screening Assistant | Azure DevOps & AKS Role
    </footer>
  </div>

  <script>
    // === INTERVIEW QUESTIONS & IDEAL ANSWERS ===
    const interviewData = [
      {
        question: "What is the role of Azure DevOps in managing AKS clusters?",
        ideal: "Azure DevOps provides CI/CD pipelines that can be integrated with AKS to automate the build, test, and deployment of containerized applications. It helps in building container images using Azure Pipelines, storing images in Azure Container Registry, deploying applications to AKS using Helm or Kubernetes manifests, and managing Infrastructure as Code using ARM templates, Bicep, or Terraform."
      },
      {
        question: "How do you deploy an application to AKS using Azure DevOps pipelines?",
        ideal: "First, build pipeline creates Docker image and pushes to ACR. Then release pipeline uses kubectl or Helm to deploy to AKS. Use service connection to authenticate with AKS and ACR. Use stages for Dev, QA, Prod with approvals."
      },
      {
        question: "What are some best practices for securing AKS in CI/CD pipelines?",
        ideal: "Use Managed Identities instead of secrets. Store secrets in Azure Key Vault. Enable RBAC and Azure AD integration. Scan container images with Microsoft Defender for Cloud or Trivy. Restrict access with Network Policies."
      },
      {
        question: "How do you handle secrets when deploying to AKS from Azure DevOps?",
        ideal: "Store secrets in Azure Key Vault. Use Azure DevOps Key Vault task to fetch secrets. In Kubernetes, use Secrets or CSI driver for Key Vault. Never hardcode secrets in manifests."
      },
      {
        question: "What is the difference between using kubectl and Helm in Azure DevOps pipelines for AKS deployment?",
        ideal: "kubectl applies Kubernetes YAML manifests directly. Good for simple deployments. Helm is a package manager with templating, versioning, and rollbacks. Better for complex apps with dependencies."
      },
      {
        question: "How do you set up monitoring for AKS in an Azure DevOps environment?",
        ideal: "Enable Azure Monitor for Containers. Use Log Analytics workspace. Integrate with Azure DevOps dashboards. Add smoke tests in pipeline. Optionally use Prometheus and Grafana."
      },
      {
        question: "How do you implement blue-green or canary deployments in AKS using Azure DevOps?",
        ideal: "Blue-Green: Deploy new version and switch traffic via Ingress. Canary: Gradually roll out using replicas or traffic weights. Use Helm or kubectl rollout. Tools like Flagger or Argo Rollouts can automate it."
      }
    ];

    let currentQ = 0;
    let totalScore = 0;
    const synth = window.speechSynthesis;
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = SpeechRecognition ? new SpeechRecognition() : null;

    const startBtn = document.getElementById("startBtn");
    const questionEl = document.getElementById("question");
    const statusEl = document.getElementById("status");
    const timerEl = document.getElementById("timer");
    const timeEl = document.getElementById("time");
    const resultEl = document.getElementById("result");
    const transcriptEl = document.getElementById("transcript");

    // Check browser support
    if (!recognition) {
      statusEl.textContent = "‚ö†Ô∏è Browser doesn't support voice recognition. Please use Google Chrome.";
      startBtn.disabled = true;
    }

    // Text-to-Speech
    function speak(text) {
      const utter = new SpeechSynthesisUtterance(text);
      utter.rate = 0.9;
      synth.speak(utter);
    }

    // Start Interview
    startBtn.onclick = () => {
      startBtn.disabled = true;
      statusEl.textContent = "üéôÔ∏è Interview started...";
      timerEl.style.display = "block";
      nextQuestion();
    };

    // Move to next question
    function nextQuestion() {
      if (currentQ >= interviewData.length) {
        showResult();
        return;
      }

      const data = interviewData[currentQ];
      questionEl.textContent = data.question;
      speak(data.question);
      transcriptEl.innerHTML += `<p class="ai-text">AI: ${data.question}</p>`;
      statusEl.textContent = "üéôÔ∏è You have 40 seconds to answer...";

      // Start countdown
      startTimer(40);
    }

    // Start 40-second Timer
    function startTimer(seconds) {
      timeEl.textContent = seconds;
      const interval = setInterval(() => {
        seconds--;
        timeEl.textContent = seconds;
        if (seconds <= 0) {
          clearInterval(interval);
          timerEl.style.display = "none";
          statusEl.textContent = "‚úÖ Answer recorded. Moving to next question...";
          recognition.stop();
          currentQ++;
          setTimeout(nextQuestion, 1000);
        }
      }, 1000);

      // Start listening
      startListening();
    }

    // Start Listening
    function startListening() {
      navigator.mediaDevices.getUserMedia({ audio: true })
        .then(stream => {
          recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            transcriptEl.innerHTML += `<p class="user-text">You: ${transcript}</p>`;
            statusEl.textContent = "‚úÖ Answer recorded.";

            // Score answer
            const score = compareAnswers(transcript, interviewData[currentQ].ideal);
            totalScore += score;
          };

          recognition.onerror = (event) => {
            console.error("Speech error:", event.error);
          };

          recognition.start();

          // Auto-stop after 40 seconds
          setTimeout(() => {
            if (recognition.state !== "inactive") recognition.stop();
            stream.getTracks().forEach(track => track.stop());
          }, 40000);

        })
        .catch(err => {
          statusEl.textContent = "Mic error: " + err.message;
        });
    }

    // Simple Text Similarity (30% keyword match)
    function compareAnswers(userAnswer, idealAnswer) {
      const userWords = userAnswer.toLowerCase().split(/\W+/);
      const idealWords = idealAnswer.toLowerCase().split(/\W+/);
      const uniqueIdeal = [...new Set(idealWords.filter(w => w.length > 3))];
      
      let matchCount = 0;
      uniqueIdeal.forEach(word => {
        if (userWords.includes(word)) matchCount++;
      });

      return (matchCount / uniqueIdeal.length) * 100;
    }

    // Show Final Result
    function showResult() {
      const avgScore = totalScore / interviewData.length;
      questionEl.textContent = "‚úÖ Interview Complete!";
      statusEl.textContent = "";
      timerEl.style.display = "none";

      if (avgScore >= 30) {
        resultEl.className = "pass";
        resultEl.innerHTML = "üéâ Congratulations! You passed the first round.<br><br>You will be contacted for the second round soon.";
      } else {
        resultEl.className = "fail";
        resultEl.innerHTML = "‚ùå Sorry, your skills do not match our requirements.<br><br>Thank you for your time.";
      }
      resultEl.style.display = "block";
    }
  </script>
</body>
</html>
